server.port=8080
spring.application.name=funaistudioapi

spring.datasource.url=jdbc:mysql://localhost:3306/db_funaistudio?useSSL=false&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=jianrui123
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.mvc.pathmatch.matching-strategy=ANT_PATH_MATCHER

# Swagger UI ??
# Spring Boot 3 + springdoc 2.x ????? /swagger-ui/index.html
springdoc.swagger-ui.path=/swagger-ui
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.operationsSorter=method
# ?? Swagger UI
springdoc.swagger-ui.enabled=true
# ??????????
spring.web.resources.add-mappings=true
# ?? springdoc ????
springdoc.api-docs.enabled=true

# MyBatis-Plus ??
mybatis-plus.configuration.map-underscore-to-camel-case=true
mybatis-plus.global-config.db-config.id-type=auto

jwt.secret=funaistudio
#10?? ??24*7 168??36000*16.8
jwt.expiration=604800
# FunAI ????????????? appInfo ?? accessUrl?
funai.siteBaseUrl=http://172.17.5.80:8080
#?????
funai.siteLinkEnabled=false
funai.siteLinkRoot=/data/funai/sites

# -----------------------------
# Workspace（用户在线开发容器）配置（本地开发默认关闭；生产环境建议在 application-prod.properties 打开）
# -----------------------------
# 是否启用 workspace 容器能力
funai.workspace.enabled=false
# workspace 宿主机持久化根目录（每用户：{root}/{userId}/apps/{appId}）
funai.workspace.hostRoot="D:\\dev\\AI\\fun-ai-studio-api-workspaces\\"
# workspace 容器镜像（建议使用你自己的 ACR 镜像，避免直连 docker hub）
funai.workspace.image=
# 容器内 dev server 端口（Vite 默认 5173）
funai.workspace.containerPort=5173
# 宿主机端口分配起始值（示例：20000+）
funai.workspace.hostPortBase=20000
# 单机最多尝试分配的端口数量（从 hostPortBase 开始向后扫描）
funai.workspace.hostPortScanSize=2000
# 容器内 workspace 目录（挂载点）
funai.workspace.containerWorkdir=/workspace
# 容器名模板：ws-u-{userId}
funai.workspace.containerNamePrefix=ws-u-
# podman/docker 网络名：用于让 workspace 容器访问同机其它服务容器（如 Verdaccio）
funai.workspace.networkName=funai-net
# npm registry（推荐同机 Verdaccio；仅容器网络访问）：http://verdaccio:4873
funai.workspace.npmRegistry=http://verdaccio:4873
# 出网代理（容器内使用；podman 下 host.containers.internal 通常可用）
funai.workspace.httpProxy=http://host.containers.internal:3128
funai.workspace.httpsProxy=http://host.containers.internal:3128
funai.workspace.noProxy=localhost,127.0.0.1,verdaccio,host.containers.internal
funai.workspace.idleStopRunMinutes=10
funai.workspace.idleStopContainerMinutes=20

# -----------------------------
# Workspace Mongo（可选）
# -----------------------------
funai.workspace.mongo.enabled=false
# Windows 本地可按需改为 D:\\...；生产建议 /data/funai/database
funai.workspace.mongo.hostRoot=/data/funai/database
funai.workspace.mongo.containerDbPath=/data/db
funai.workspace.mongo.containerLogDir=/var/log/mongodb
funai.workspace.mongo.bindIp=127.0.0.1
funai.workspace.mongo.port=27017
funai.workspace.mongo.dbNamePrefix=db_
funai.workspace.mongo.logFileName=mongod.log

# -----------------------------
# API 服务器（小机）-> Workspace 开发服务器（大机）workspace-node 应用层代理（双机模式）
# 本地开发默认关闭；生产环境请在 application-prod.properties 开启并配置 shared-secret。
# -----------------------------
workspace-node-proxy.enabled=false
workspace-node-proxy.base-url=http://172.21.138.87:7001
workspace-node-proxy.shared-secret=ac462cfa76135504d2b750d541064ed5f03eb9f78f9068645995c4f825455f52
workspace-node-proxy.connect-timeout-ms=2000
workspace-node-proxy.read-timeout-ms=0
workspace-node-proxy.run-status-timeout-ms=1200
workspace-node-proxy.body-spool-threshold-bytes=2097152

# -----------------------------
# Deploy 控制面（API -> deploy 服务）
# -----------------------------
# 是否启用 deploy 控制面调用（本地可先 false；生产建议 true + 内网地址）
deploy-proxy.enabled=false
# deploy 服务基地址，例如 http://127.0.0.1:7002 或 http://172.21.xx.xx:7002
deploy-proxy.base-url=http://127.0.0.1:7002
# 预留：内部调用共享密钥（后续 deploy 服务加 InternalAuth 时启用）
deploy-proxy.shared-secret=
# 读取超时（毫秒）：避免 /deploy/apps/cleanup 卡住导致 API 线程长期阻塞
deploy-proxy.read-timeout-ms=8000
deploy-proxy.list-jobs-timeout-ms=1500

# -----------------------------
# App 删除接口（/api/fun-ai/app/delete）体验参数
# -----------------------------
# 删除接口最多等待外部清理（workspace/gitea/deploy）多久来收集“快速失败/快速成功”的结果；超时则秒回并后台继续清理
# - 0：最快（直接返回）
# - 300~1500：更容易在响应里看到清理失败原因，但不会明显拖慢接口
funai.app.delete.cleanup-wait-ms=800

# -----------------------------
# workspace-node 节点注册/心跳（API 服务侧）
# -----------------------------
funai.workspace-node-registry.enabled=true
# 与 workspace-node 侧上报 Header：X-WS-Node-Token 一致
funai.workspace-node-registry.shared-secret=4f2b1a9c8d3e7a60b1c9d7e5f3a8b6c4d2e0f9a7c5b3d1e8f6a4c2e9b7d5f0a1c3e8b2d6f9a0c4e7b1d5f8a2c6e9b3d7f0a4c8e1b5d9f2a6c0e3b7d1f4a8c2e5b9d0f3a7c1e4b8d2f5a9c3e6b0d4f7a1c5e8b2d6f9a0c4e7b1d5f8a2c6e9b3d7f0a4c8e1b5d9f2a6c0e3b7d1f4a8c2
# 可选：节点来源 IP 白名单（为空则不校验）
funai.workspace-node-registry.allowed-ips=172.21.138.87
# 心跳超时阈值（秒）：超过视为不健康（选择策略会过滤）
funai.workspace-node-registry.heartbeat-stale-seconds=60

# -----------------------------
# workspace-node 故障转移（API 服务侧）
# -----------------------------
workspace-node.failover.auto-reassign.enabled=false
workspace-node.failover.auto-reassign.max-idle-minutes=30

#build.buildedPath=D:\\dev\\h5\\code\\talos\\dist\\
spring.ai.dashscope.api-key=sk-8e78660ba8034d528093e4fd7839f7df
#?????????
spring.ai.alibaba.bialian.enable=true
spring.ai.alibaba.bialian.index-name="saa-playground-2"

# ????
logging.level.root=INFO

# -----------------------------
# AI 对话上下文管理配置
# -----------------------------
# 每个应用允许的最大活跃会话数
funai.conversation.max-conversations-per-app=5
# 每个会话允许的最大消息数
funai.conversation.max-messages-per-conversation=30
