server.port=8080
spring.application.name=funaistudioapi

spring.datasource.url=jdbc:mysql://localhost:3306/db_funaistudio?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.password=Ss123456!
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.mvc.pathmatch.matching-strategy=ANT_PATH_MATCHER

# Swagger UI ??
# Spring Boot 3 + springdoc 2.x ????? /swagger-ui/index.html
springdoc.swagger-ui.path=/swagger-ui
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.operationsSorter=method
# ?? Swagger UI
springdoc.swagger-ui.enabled=true
# ??????????
spring.web.resources.add-mappings=true
# ?? springdoc ????
springdoc.api-docs.enabled=true

# MyBatis-Plus ??
mybatis-plus.configuration.map-underscore-to-camel-case=true
mybatis-plus.global-config.db-config.id-type=auto

jwt.secret=funaistudio
#10?? ??24*7 168??36000*16.8
jwt.expiration=604800
# FunAI 对外站点基址（用于拼接外链/访问地址）
# 建议填写公网入口 IP 或域名
funai.siteBaseUrl=http://47.93.150.220/
#?????
funai.siteLinkEnabled=true
funai.siteLinkRoot=/data/funai/sites

# -----------------------------
# Workspace（双机模式：API 服务器裁剪）
# - API 服务器（小机）保留 controller 用于 Swagger 展示
# - /api/fun-ai/workspace/** 的实际执行由 workspace-node 负责（API 服务器（小机）仅转发/签名）
# -----------------------------
funai.workspace.enabled=false
# -----------------------------
# API 服务器（小机）-> Workspace 开发服务器（大机）workspace-node 应用层代理（双机模式）
# - API 服务器（小机）对外仍暴露 /api/fun-ai/workspace/**（Swagger 可见）
# - 实际由 API 服务器（小机）转发到 Workspace 开发服务器（大机）workspace-node，并附带 X-WS-* 签名头
# -----------------------------
workspace-node-proxy.enabled=true
workspace-node-proxy.base-url=http://172.21.138.87:7001
# 与 Workspace 开发服务器（大机）workspace-node.internal.shared-secret 保持一致
workspace-node-proxy.shared-secret=ac462cfa76135504d2b750d541064ed5f03eb9f78f9068645995c4f825455f52
workspace-node-proxy.connect-timeout-ms=2000
# 0 表示不设置（SSE/下载更友好）
workspace-node-proxy.read-timeout-ms=0
# 计算签名需要 body sha256：超过阈值会落盘临时文件避免 OOM
workspace-node-proxy.body-spool-threshold-bytes=2097152
#build.buildedPath=D:\\dev\\h5\\code\\talos\\dist\\
spring.ai.dashscope.api-key=sk-8e78660ba8034d528093e4fd7839f7df
#?????????
spring.ai.alibaba.bialian.enable=true
spring.ai.alibaba.bialian.index-name="saa-playground-2"

# ????
logging.level.root=INFO
# -----------------------------
# 日志落盘（API 服务）
# -----------------------------
logging.file.name=/data/funai/logs/fun-ai-studio-api/app.log

# 按天滚动 + 按大小分片（必须包含 %i；gzip 压缩）
logging.logback.rollingpolicy.file-name-pattern=/data/funai/logs/fun-ai-studio-api/app.%d{yyyy-MM-dd}.%i.log.gz
# 单文件最大大小（超过会在同一天内滚动到下一个 %i）
logging.logback.rollingpolicy.max-file-size=100MB

# 保留最近 30 天
logging.logback.rollingpolicy.max-history=30

# 总日志大小上限（超过会清理旧日志）
logging.logback.rollingpolicy.total-size-cap=5GB

# 启动时清理超期日志
logging.logback.rollingpolicy.clean-history-on-start=true

# -----------------------------
# 上传大小限制（避免 upload-zip 几 MB 就触发默认 1MB 限制）
# - 注意：Nginx 也需要 client_max_body_size 配合（我们已在 nginx 示例里设置为 200m）
# -----------------------------
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=200MB
spring.servlet.multipart.max-request-size=200MB
# Tomcat：避免大请求被吞掉导致连接异常（与上面保持一致/更大）
server.tomcat.max-swallow-size=200MB
